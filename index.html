<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario de Valoración</title>
    <style>
        .section {
            display: none;
        }
        .section.active {
            display: block;
        }
        .highlight {
            background-color: red;
        }
    </style>
</head>
<body>
    <form id="valoracionForm">
        <div id="section1" class="section active">
            <h2>Valoración Inicial</h2>
            <fieldset>
                <legend>Datos Administrativos</legend>
                <div>
                    <label for="nhc">NHC:</label>
                    <input type="text" id="nhc" name="nhc">
                </div>
                <div>
                    <label for="primerApellido">1er Apellido:</label>
                    <input type="text" id="primerApellido" name="primerApellido">
                </div>
                <div>
                    <label for="segundoApellido">2º Apellido:</label>
                    <input type="text" id="segundoApellido" name="segundoApellido">
                </div>
                <div>
                    <label for="nombre">Nombre:</label>
                    <input type="text" id="nombre" name="nombre">
                </div>
                <div>
                    <label for="edad">Edad:</label>
                    <input type="number" id="edad" name="edad" onchange="evaluateStressEcho()">
                </div>
                <div>
                    <label for="sexo">Sexo:</label>
                    <select id="sexo" name="sexo">
                        <option value="1">Hombre</option>
                        <option value="2">Mujer</option>
                    </select>
                </div>
                <div>
                    <label for="peso">Peso:</label>
                    <input type="number" id="peso" name="peso">
                </div>
                <div>
                    <label for="talla">Talla:</label>
                    <input type="number" id="talla" name="talla">
                </div>
            </fieldset>
            <fieldset>
                <legend>Trasplante</legend>
                <div>
                    <label for="tipoTrasplante">Tipo de Trasplante:</label>
                    <select id="tipoTrasplante" name="tipoTrasplante">
                        <option value="1">Trasplante</option>
                        <option value="2">Re-trasplante</option>
                    </select>
                </div>
                <div>
                    <label>Indicación:</label>
                    <div>
                        <input type="checkbox" id="hepatocarcinoma" name="indicacion" value="Hepatocarcinoma">
                        <label for="hepatocarcinoma">Hepatocarcinoma</label>
                    </div>
                    <div>
                        <input type="checkbox" id="cirrosisAlcoholica" name="indicacion" value="Cirrosis Alcohólica">
                        <label for="cirrosisAlcoholica">Cirrosis Alcohólica</label>
                    </div>
                    <div>
                        <input type="checkbox" id="cirrosisVirusB" name="indicacion" value="Cirrosis por virus B">
                        <label for="cirrosisVirusB">Cirrosis por virus B</label>
                    </div>
                    <div>
                        <input type="checkbox" id="cirrosisVirusC" name="indicacion" value="Cirrosis por virus C">
                        <label for="cirrosisVirusC">Cirrosis por virus C</label>
                    </div>
                    <div>
                        <input type="checkbox" id="cirrosisNASH" name="indicacion" value="Cirrosis NASH">
                        <label for="cirrosisNASH">Cirrosis NASH</label>
                    </div>
                    <div>
                        <input type="checkbox" id="cirrosisAutoinmune" name="indicacion" value="Cirrosis Autoinmune">
                        <label for="cirrosisAutoinmune">Cirrosis Autoinmune</label>
                    </div>
                    <div>
                        <input type="checkbox" id="cirrosisCriptogenica" name="indicacion" value="Cirrosis Criptogénica">
                        <label for="cirrosisCriptogenica">Cirrosis Criptogénica</label>
                    </div>
                    <div>
                        <input type="checkbox" id="cirrosisBiliarPrimaria" name="indicacion" value="Cirrosis Biliar Primaria">
                        <label for="cirrosisBiliarPrimaria">Cirrosis Biliar Primaria</label>
                    </div>
                    <div>
                        <input type="checkbox" id="colangitisEsclerosante" name="indicacion" value="Colangitis Esclerosante">
                        <label for="colangitisEsclerosante">Colangitis Esclerosante</label>
                    </div>
                    <div>
                        <input type="checkbox" id="hemangioma" name="indicacion" value="Hemangioma">
                        <label for="hemangioma">Hemangioma</label>
                    </div>
                    <div>
                        <input type="checkbox" id="poliquistosisOvarica" name="indicacion" value="Poliquistosis Ovárica">
                        <label for="poliquistosisOvarica">Poliquistosis Ovárica</label>
                    </div>
                    <div>
                        <input type="checkbox" id="buddChiari" name="indicacion" value="Budd Chiari">
                        <label for="buddChiari">Budd Chiari</label>
                    </div>
                    <div>
                        <input type="checkbox" id="falloHepaticoAgudo" name="indicacion" value="Fallo Hepático Agudo">
                        <label for="falloHepaticoAgudo">Fallo Hepático Agudo</label>
                    </div>
                    <div>
                        <input type="checkbox" id="falloHepaticoAgudoSobreCronico" name="indicacion" value="Fallo Hepático Agudo Sobre Crónico">
                        <label for="falloHepaticoAgudoSobreCronico">Fallo Hepático Agudo Sobre Crónico</label>
                    </div>
                    <div>
                        <input type="checkbox" id="hepatitisAgudaSubfulminante" name="indicacion" value="Hepatítis Aguda subfulminante">
                        <label for="hepatitisAgudaSubfulminante">Hepatítis Aguda subfulminante</label>
                    </div>
                    <div>
                        <input type="checkbox" id="trombosisArteriaHepatica" name="indicacion" value="Trombosis de arteria Hepática">
                        <label for="trombosisArteriaHepatica">Trombosis de arteria Hepática</label>
                    </div>
                    <div>
                        <input type="checkbox" id="trombosisPortal" name="indicacion" value="Trombosis Portal">
                        <label for="trombosisPortal">Trombosis Portal</label>
                    </div>
                    <div>
                        <input type="checkbox" id="malfuncionPrimaria" name="indicacion" value="Malfunción Primaria">
                        <label for="malfuncionPrimaria">Malfunción Primaria</label>
                    </div>
                </div>
            </fieldset>
            <fieldset>
                <legend>Clasificación Child Pugh</legend>
                <div>
                    <label for="ascitis">Ascitis:</label>
                    <select id="ascitis" name="ascitis" onchange="updateChildPughScore()">
                        <option value="1" selected>Ausente</option>
                        <option value="2">Leve</option>
                        <option value="3">Moderada</option>
                    </select>
                </div>
                <div>
                    <label for="bilirrubina">Bilirrubina:</label>
                    <select id="bilirrubina" name="bilirrubina" onchange="updateChildPughScore()">
                        <option value="1" selected>&lt;=2</option>
                        <option value="2">2-3</option>
                        <option value="3">&gt;3</option>
                    </select>
                </div>
                <div>
                    <label for="inr">INR:</label>
                    <select id="inr" name="inr" onchange="updateChildPughScore()">
                        <option value="1" selected>&lt;1.8</option>
                        <option value="2">1.8-2.3</option>
                        <option value="3">&gt;2.3</option>
                    </select>
                </div>
                <div>
                    <label for="encefalopatia">Encefalopatía:</label>
                    <select id="encefalopatia" name="encefalopatia" onchange="updateChildPughScore()">
                        <option value="1" selected>Ausente</option>
                        <option value="2">Grado 1-2 (Alteración mínima del comportamiento - Desorientación leve, asterixis)</option>
                        <option value="3">Grado 3-4 (Confusión severa, somnolencia - Coma)</option>
                    </select>
                </div>
                <div>
                    <label for="childPughScore">Puntuación Child Pugh:</label>
                    <span id="childPughScore">4</span>
                </div>
                <div>
                    <label for="escalaChild">Escala Child:</label>
                    <select id="escalaChild" name="escalaChild" onchange="highlightChildRow()">
                        <option value="1">Child A: 5-6 puntos</option>
                        <option value="2">Child B: 7-9 puntos</option>
                        <option value="3">Child C: 10-15 puntos</option>
                    </select>
                </div>
                <h3>Mortalidad de los pacientes a un año y dos años en función de la clasificación Child</h3>
                <table border="1" id="mortalidadChildTable">
                    <tr>
                        <th>Clasificación Child</th>
                        <th>Mortalidad a 1 año</th>
                        <th>Mortalidad a 2 años</th>
                    </tr>
                    <tr id="childA">
                        <td>Child A</td>
                        <td>100%</td>
                        <td>85%</td>
                    </tr>
                    <tr id="childB">
                        <td>Child B</td>
                        <td>80%</td>                        
                        <td>60%</td>
                    </tr>
                    <tr id="childC">
                        <td>Child C</td>
                        <td>45%</td>                        
                        <td>35%</td>
                    </tr>
                </table>
            </fieldset>
            <fieldset>
                <legend>Puntuación MELD</legend>
                <div>
                    <label for="creatinina">Creatinina (mg/dl):</label>
                    <input type="number" id="creatinina" name="creatinina" step="0.01" value="1" onchange="updateMeldScores()">
                </div>
                <div>
                    <label for="inrMeld">INR:</label>
                    <input type="number" id="inrMeld" name="inrMeld" step="0.01" value="1" onchange="updateMeldScores()">
                </div>
                <div>
                    <label for="bilirrubinaMeld">Bilirrubina (mg/dl):</label>
                    <input type="number" id="bilirrubinaMeld" name="bilirrubinaMeld" step="0.01" value="1" onchange="updateMeldScores()">
                </div>
                <div>
                    <label for="sodio">Na (mmol/L):</label>
                    <input type="number" id="sodio" name="sodio" step="0.01" value="140" onchange="updateMeldScores()">
                </div>
                <div>
                    <label>Creatinina: Valor máximo 4. Si el paciente ha sido sometido a diálisis 2 veces en la semana previa, puntuar 4</label>
                </div>
                <div>
                    <label for="meldScore">MELD Score:</label>
                    <span id="meldScore">0</span>
                </div>
                <div>
                    <label for="meldNaScore">MELD-Na Score:</label>
                    <span id="meldNaScore">0</span>
                </div>
                <h3>Mortalidad a tres meses</h3>
                <table border="1" id="mortalidadTresMesesTable">
                    <tr>
                        <th>Valores MELD</th>
                        <th>Mortalidad</th>
                    </tr>
                    <tr id="meld40">
                        <td>40 o más</td>
                        <td>71%</td>
                    </tr>
                    <tr id="meld30_39">
                        <td>30-39</td>
                        <td>52%</td>
                    </tr>
                    <tr id="meld20_29">
                        <td>20-29</td>
                        <td>19%</td>
                    </tr>
                    <tr id="meld10_19">
                        <td>10-19</td>
                        <td>6%</td>
                    </tr>
                    <tr id="meldMenor9">
                        <td>&lt;9</td>
                        <td>2%</td>
                    </tr>
                </table>
            </fieldset>
            <button type="button" onclick="showNextSection(1)">Siguiente</button>
        </div>
        <div id="section2" class="section">
            <h2>Valoración Cardiológica</h2>
            <fieldset>
                <legend>Factores de Riesgo Cardiovascular</legend>
                <div>
                    <input type="checkbox" id="diabetes" name="diabetes" onchange="evaluateStressEcho()">
                    <label for="diabetes">Diabetes</label>
                </div>
                <div>
                    <input type="checkbox" id="hipertension" name="hipertension" onchange="evaluateStressEcho()">
                    <label for="hipertension">Hipertensión</label>
                </div>
                <div>
                    <input type="checkbox" id="dislipidemia" name="dislipidemia" onchange="evaluateStressEcho()">
                    <label for="dislipidemia">Dislipidemia</label>
                </div>
                <div>
                    <input type="checkbox" id="tabaquismo" name="tabaquismo" onchange="evaluateStressEcho()">
                    <label for="tabaquismo">Tabaquismo (actual o pasado)</label>
                </div>
                <div>
                    <input type="checkbox" id="obesidad" name="obesidad" onchange="evaluateStressEcho()">
                    <label for="obesidad">Obesidad</label>
                </div>
                <div>
                    <input type="checkbox" id="historiaPatologiaCoronaria" name="historiaPatologiaCoronaria" onchange="evaluateStressEcho()">
                    <label for="historiaPatologiaCoronaria">Historia previa o clínica de patología coronaria</label>
                </div>
                <div>
                    <input type="checkbox" id="historiaFamiliarPatologiaCoronaria" name="historiaFamiliarPatologiaCoronaria" onchange="evaluateStressEcho()">
                    <label for="historiaFamiliarPatologiaCoronaria">Historia familiar de patología coronaria</label>
                </div>
                <div>
                    <input type="checkbox" id="arteriopatiaPeriferica" name="arteriopatiaPeriferica" onchange="evaluateStressEcho()">
                    <label for="arteriopatiaPeriferica">Presencia de arteriopatía periférica</label>
                </div>
                
            </fieldset>
            <fieldset>
                <legend>Electrocardiograma</legend>
                <div>
                    <label for="ritmo">Ritmo:</label>
                    <select id="ritmo" name="ritmo">
                        <option value="1">Sinusal</option>
                        <option value="2">Fibrilación Auricular</option>
                        <option value="3">Flutter Auricular</option>
                        <option value="4">Bloqueo AV 1er grado</option>
                        <option value="5">Bloqueo AV 2do grado</option>
                        <option value="6">Otros</option>
                    </select>
                </div>
                <div>
                    <label for="qtc">QTc:</label>
                    <input type="number" id="qtc" name="qtc" step="0.01">
                </div>
                <div>
                    <label for="descripcionEcg">Descripción:</label>
                    <textarea id="descripcionEcg" name="descripcionEcg"></textarea>
                </div>
            </fieldset>
            <fieldset>
                <legend>Ecocardiografia</legend>
                <div>
                    <label for="fraccionEyeccion">Fracción de Eyección VI:</label>
                    <select id="fraccionEyeccion" name="fraccionEyeccion">
                        <option value="1">Normal (&gt;50%)</option>
                        <option value="2">Levemente Disminuida (40-49%)</option>
                        <option value="3">Moderadamente disminuida (30-39%)</option>
                        <option value="4">Severamente disminuida (&lt;30%)</option>
                    </select>
                </div>
                <div>
                    <label for="fraccionVD">Función VD:</label>
                    <select id="fraccionVD" name="fraccionVD">
                        <option value="1">Normal</option>
                        <option value="2">Deprimida</option>
                    </select>
                </div>
                <div>
                    <label for="papsEstimada">PAPs estimada:</label>
                    <input type="number" id="papsEstimada" name="papsEstimada"  step="1">
                </div>
                <div>
                    <label for="Tapse">TAPSE:</label>
                    <input type="number" id="Tapse" name="Tapse"  step="1">
                </div>
                <div>
                    <label for="descripcionCardiologica">Descripción:</label>
                    <textarea id="descripcionCardiologica" name="descripcionCardiologica"></textarea>
                </div>
            </fieldset>
            
            <fieldset>
                <legend>Índice HFA PEEF</legend>
                <div id="resultadoHfaPeef" style="padding: 5px; background-color: green; color: white;">
                    Bajo riesgo de insuficiencia cardiaca
                </div>
                <!-- Sección Funcional -->
                <div>
                    <label for="funcional">Funcional</label>
                    <select id="funcional" required onchange="calculateHfaPeefIndex()">
                        <option value="0" selected>Normal (0 puntos)</option>
                        <option value="2">e' Septal &lt; 7 cm/seg ó e' Lateral &lt; 10 cm/seg (2 puntos)</option>
                        <option value="2">Relación E/e' ≥ 15 (2 puntos)</option>
                        <option value="2">PASP &gt; 35 mmHg (2 puntos)</option>
                        <option value="1">Relación E/e' 9-14 (1 punto)</option>
                        <option value="1">Global Strain &lt; 16% (1 punto)</option>
                    </select>
                </div>

                <!-- Sección Morfológico -->
                <div>
                    <label for="morfologico">Morfológico</label>
                    <select id="morfologico" required onchange="calculateHfaPeefIndex()">
                        <option value="0" selected>Normal (0 puntos)</option>
                        <option value="2">Vol. Aurícula izquierda &gt; 34 ml/m<sup>2</sup> (2 puntos)</option>
                        <option value="2">Masa VI &gt; 149/122 m<sup>2</sup> + Grosor relativo pared &gt; 0.42 (2 puntos)</option>
                        <option value="1">Vol. Aurícula izquierda 29-34 ml/m<sup>2</sup> (1 punto)</option>
                        <option value="1">Masa VI &gt; 115/95 gr/m<sup>2</sup> (1 punto)</option>
                        <option value="1">Grosor pared VI &ge; 12 mm (1 punto)</option>
                    </select>
                </div>

                <!-- Sección Biomarcador en ritmo sinusal -->
                <div>
                    <label for="biomarcador">Biomarcador en ritmo sinusal</label>
                    <select id="biomarcador" onchange="calculateHfaPeefIndex(); resetBiomarcadorFA()">
                        <option value="0" selected>Normal (0 puntos)</option>
                        <option value="2">NT-proBNP &gt; 220 pg/ml (2 puntos)</option>
                        <option value="1">NT-proBNP 115-220 pg/ml (1 punto)</option>
                    </select>
                </div>

                <!-- Sección Biomarcador en FA -->
                <div>
                    <label for="biomarcadorFA">Biomarcador en FA</label>
                    <select id="biomarcadorFA" onchange="calculateHfaPeefIndex(); resetBiomarcador()">
                        <option value="0" selected>Normal (0 puntos)</option>
                        <option value="2">NT-proBNP &gt; 660 pg/ml (2 puntos)</option>
                        <option value="1">NT-proBNP 365-660 pg/ml (1 punto)</option>
                    </select>
                </div>

                <div>
                    <label for="indiceHfaPeef">Índice HFA PEEF:</label>
                    <span id="indiceHfaPeef">0</span>
                </div>
                
            </fieldset>
            <fieldset>
                <legend>Ecocardiograma de Stress</legend>
                <div id="stressEchoMessage" style="padding: 5px; background-color: green; color: white;">
                    No es necesario ecocardiograma de stress
                </div>
                <div>
                    <label for="resultadoStress">Resultado:</label>
                    <select id="resultadoStress" name="resultadoStress">
                        <option value="0">No indicado</option>
                        <option value="1">No puede realizarse</option>
                        <option value="2">No concluyente</option>
                        <option value="3">Concluyente positivo para isquemia</option>
                        <option value="4">Concluyente negativo para isquemia</option>
                    </select>
                </div>
                <div>
                    <label for="comentarioStress">Comentario:</label>
                    <textarea id="comentarioStress" name="comentarioStress"></textarea>
                </div>
            </fieldset>
            <fieldset>
                <legend>AngioTAC</legend>
                <div id="angioTacMessage" style="padding: 5px; background-color: green; color: white;">
                    No es necesario angioTAC
                </div>
                <div>
                    <input type="checkbox" id="estenosisDerecha" name="estenosisDerecha">
                    <label for="estenosisDerecha">Estenosis coronaria derecha &gt;70%</label>
                </div>
                <div>
                    <input type="checkbox" id="estenosisIzquierda" name="estenosisIzquierda">
                    <label for="estenosisIzquierda">Estenosis coronaria izquierda &gt;50%</label>
                </div>
                <div>
                    <input type="checkbox" id="scoreCalcico" name="scoreCalcico">
                    <label for="scoreCalcico">Score calcico por encima de 100</label>
                </div>
                <div>
                    <label for="comentarioAngioTac">Comentario:</label>
                    <textarea id="comentarioAngioTac" name="comentarioAngioTac"></textarea>
                </div>
            </fieldset>
            <fieldset>
                <legend>Coronariografía</legend>
                <div id="coronariografiaMessage" style="padding: 5px; background-color: green; color: white;">
                    No es necesario realizar coronariografía
                </div>
                <div>
                    <label for="resultadoCoronariografia">Revascularizado:</label>
                    <select id="resultadoCoronariografia" name="resultadoCoronariografia">
                        <option value="0">No indicado</option>
                        <option value="1">No puede realizarse</option>
                        <option value="2">Revascularizado</option>
                    </select>
                </div>
                <div>
                    <label for="comentarioCoronariografia">Comentario:</label>
                    <textarea id="comentarioCoronariografia" name="comentarioCoronariografia"></textarea>
                </div>
            </fieldset>
            <fieldset>
                <legend>Cateterismo Derecho</legend>
                <div id="cateterismoMessage" style="padding: 5px; background-color: green; color: white;">
                    No es necesario cateterismo derecho
                </div>
                <div>
                    <label for="paps">PAPs:</label>
                    <input type="number" id="paps" name="paps"  step="1">
                </div>
                <div>
                    <label for="papmSelect">PAPm:</label>
                    <select id="papmSelect" name="papmSelect">
                        <option value="0" selected>Normal (PAPm &lt; 25)</option>
                        <option value="1">HTP leve (PAPm 25-34)</option>
                        <option value="2">HTP moderada (PAPm 35-44)</option>
                        <option value="3">HTP severa (PAPm &ge; 45)</option>
                    </select>
                </div>
                <div>
                    <label for="irvp">IRVP:</label>
                    <input type="number" id="irvp" name="irvp" step="0.01">
                </div>
                <div>
                    <label for="pshl">PSHL:</label>
                    <input type="number" id="pshl" name="pshl" step="0.01">
                </div>
                <div>
                    <label for="pshe">PSHE:</label>
                    <input type="number" id="pshe" name="pshe" step="0.01">
                </div>
                
                <div>
                    <label for="comentarioCateterismo">Comentario:</label>
                    <textarea id="comentarioCateterismo" name="comentarioCateterismo"></textarea>
                </div>
            </fieldset>
            <button type="button" onclick="showPreviousSection(2)">Anterior</button>
            <button type="button" onclick="showNextSection(2)">Siguiente</button>
        </div>
        <div id="section3" class="section">
            <h2>Valoración Pulmonar y Vía aérea</h2>
            <fieldset>
                <legend>Rx tórax</legend>
                <div>
                    <label for="rxTorax">Hidrotórax</label>
                    <select id="rxTorax" name="rxTorax">
                        <option value="no" selected>No</option>
                        <option value="si">Sí</option>
                    </select>
                </div>
            </fieldset>
            <fieldset>
                <legend>Valoración gasométrica</legend>
                <div>
                    <label for="ph">Ph:</label>
                    <input type="number" id="ph" name="ph" step="0.01" onchange="evaluateAnionGap()">
                </div>
                <div>
                    <label for="pao2">PaO2:</label>
                    <input type="number" id="pao2" name="pao2" step="0.01">
                </div>
                <div>
                    <label for="paco2">PaCO2:</label>
                    <input type="number" id="paco2" name="paco2" step="0.01">
                </div>
                <div>
                    <label for="hco3">HCO3:</label>
                    <input type="number" id="hco3" name="hco3" step="0.01" onchange="evaluateAnionGap()">
                </div>
                <div>
                    <label for="eb">EB:</label>
                    <input type="number" id="eb" name="eb" step="0.01">
                </div>
                <div>
                    <label for="cl">Cl:</label>
                    <input type="number" id="cl" name="cl" step="0.01" onchange="evaluateAnionGap()">
                </div>
                <div>
                    <label for="na">Na:</label>
                    <input type="number" id="na" name="na" step="0.01" onchange="evaluateAnionGap()">
                </div>
                <div>
                    <label for="fio2">FiO2:</label>
                    <input type="number" id="fio2" name="fio2" step="0.01" min="0" max="1" value="0.21" onchange="evaluateAnionGap(); evaluateAaGradient()">
                </div>
    
                <div id="aaGradientMessage" style="padding: 5px; background-color: green; color: white;">
                    Gradiente A-a de oxígeno: normal
                </div>
                
                <table border="1" id="gravedadShpTable">
                    <thead>
                        <tr>
                            <th>Gravedad SHP</th>
                            <th>PaO2</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr id="leve">
                            <td>Leve</td>
                            <td>&gt;=80</td>
                        </tr>
                        <tr id="moderada">
                            <td>Moderada</td>
                            <td>60-79</td>
                        </tr>
                        <tr id="severa">
                            <td>Severa</td>
                            <td>50-59</td>
                        </tr>
                        <tr id="muySevera">
                            <td>Muy severa</td>
                            <td>&lt;50</td>
                        </tr>
                    </tbody>
                </table>
            </fieldset>
            <fieldset>
                <legend>Ecocardiografia de contraste</legend>
                <div id="ecoContrasteMessage" style="padding: 5px; background-color: green; color: white;">
                    No se requiere ecografía de contraste
                </div>
                <div>
                    <label for="shunt">Shunt:</label>
                    <select id="shunt" name="shunt">
                        <option value="0">No indicado</option>
                        <option value="1">&lt;10%</option>
                        <option value="2">10-20%</option>
                        <option value="3">&gt;20%</option>
                    </select>
                </div>
            </fieldset>
            <fieldset>
                <legend>Pruebas de Función Respiratoria</legend>
                <div>
                    <label for="fev1">FEV1 (% predicho):</label>
                    <input type="number" id="fev1" name="fev1" step="0.01" onchange="evaluatePulmonaryFunction()">
                </div>
                <div>
                    <label for="fvc">FVC (% predicho):</label>
                    <input type="number" id="fvc" name="fvc" step="0.01" onchange="evaluatePulmonaryFunction()">
                </div>
                <div>
                    <label for="fev1FvcRatio">FEV1/FVC:</label>
                    <span id="fev1FvcRatio">0</span>
                </div>
                <div id="pulmonaryFunctionMessage" style="padding: 5px; background-color: green; color: white;">
                    Resultado de la función pulmonar
                </div>
            </fieldset>
            <button type="button" onclick="showPreviousSection(3)">Anterior</button>
            <button type="button" onclick="showNextSection(3)">Siguiente</button>
        </div>
        <div id="section4" class="section">
            <h2>Valoración Renal</h2>
            <fieldset>
                <legend>Analítica</legend>
                <div>
                    <label for="currentCreatinine">Creatinina actual:</label>
                    <input type="number" id="currentCreatinine" value ="0.5" oninput="calculateEGFR()">
                </div>
                
                <div id="egfrMessage" style="padding: 5px; background-color: green; color: white;">
                    eGFR: <span id="egfrValue">0</span> mL/min/1.73m²
                </div>

                <table border="1" id="egfrTable">
                    <tr>
                        <th>Grado</th>
                        <th>eGFR</th>
                        <th>Definición</th>
                    </tr>
                    <tr id="grado1">
                        <td>Grado 1</td>
                        <td>>=90</td>
                        <td>Normal o aumentado</td>
                    </tr>
                    <tr id="grado2">
                        <td>Grado 2</td>
                        <td>60-89</td>
                        <td>Levemente disminuido</td>
                    </tr>
                    <tr id="grado3a">
                        <td>Grado 3a</td>
                        <td>45-59</td>
                        <td>Leve a moderadamente disminuido</td>
                    </tr>
                    <tr id="grado3b">
                        <td>Grado 3b</td>
                        <td>30-44</td>
                        <td>Moderado a severamente disminuido</td>
                    </tr>
                    <tr id="grado4">
                        <td>Grado 4</td>
                        <td>15-29</td>
                        <td>Severamente disminuido</td>
                    </tr>
                    <tr id="grado5">
                        <td>Grado 5</td>
                        <td><15</td>
                        <td>Fracaso renal</td>
                    </tr>
                </table>
                <div>
                    <label for="previousCreatinine">Creatinina previa (últimos 3 meses):</label>
                    <input type="number" id="previousCreatinine" value= "0.5" oninput="checkAKI()">
                </div>
                <div id="akiMessage" style="padding: 5px; background-color:green; color:white;">
                    Bajo riesgo de AKI
                </div>
            </fieldset>
            <fieldset>
                <legend>Riesgo de CRRT intraoperatoria</legend>
                <div>
                    <label for="falloHepatico">Fallo Hepático:</label>
                    <select id="falloHepatico" name="falloHepatico" onchange="calculateCRRTScore()">
                        <option value="1" selected>Crónico</option>
                        <option value="2">Agudo</option>
                    </select>
                </div>
                <div>
                    <label for="donanteAsistolia">Donante en asistolia:</label>
                    <select id="donanteAsistolia" name="donanteAsistolia" onchange="calculateCRRTScore()">
                        <option value="0" selected>No</option>
                        <option value="1">Sí</option>
                    </select>
                </div>
                <div>
                    <label for="retrasplante">Retrasplante:</label>
                    <select id="retrasplante" name="retrasplante" onchange="calculateCRRTScore()">
                        <option value="0" selected>No</option>
                        <option value="1">Sí</option>
                    </select>
                </div>
                <div>
                    <label for="vasopresoresPreop">Vasopresores preop:</label>
                    <select id="vasopresoresPreop" name="vasopresoresPreop" onchange="calculateCRRTScore()">
                        <option value="0" selected>No</option>
                        <option value="1">Sí</option>
                    </select>
                </div>
                <div>
                    <label for="crrtPreop">CRRT preop:</label>
                    <select id="crrtPreop" name="crrtPreop" onchange="calculateCRRTScore()">
                        <option value="0" selected>No</option>
                        <option value="1">Sí</option>
                    </select>
                </div>
                <div>
                    <label for="kPreop">K+ preop:</label>
                    <input type="number" id="kPreop" name="kPreop" step="0.01" onchange="calculateCRRTScore()">
                </div>
                <div>
                    <label for="bilirrubina">Bilirrubina:</label>
                    <input type="number" id="bilirrubina" name="bilirrubina" step="0.01" onchange="calculateCRRTScore()">
                </div>
                <div id="crrtScoreMessage" style="padding: 5px; background-color:blue; color: white;">
                    Score de CRRT: 0
                </div>
            </fieldset>
            <button type="button" onclick="showPreviousSection(4)">Anterior</button>
            <button type="button" onclick="showNextSection(4)">Siguiente</button>
        </div>
        <div id="section5" class="section">
        <h2>Valoración Hematológica</h2>
        <fieldset>
            <legend>Riesgo de Sangrado</legend>
            <label for="retrasplantehemato">Retrasplante:</label>
            <select id="retrasplantehemato" name="retrasplantehemato">
                <option value="0" selected>No</option>
                <option value="1">Sí</option>
            </select>
            <br>
            <label for="sexohemato">Sexo:</label>
            <select id="sexohemato" name="sexohemato">
                <option value="1" selected>Hombre</option>
                <option value="2">Mujer</option>
            </select>
            <br>
            <label for="edadhemato">Edad:</label>
            <input type="number" id="edadhemato" name="edadhemato">
            <br>
            <label for="hemoglobina">Hemoglobina:</label>
            <input type="number" id="hemoglobina" name="hemoglobina" >
            <br>
            <label for="protrombina">INR:</label>
            <input type="number" id="protrombina" name="protrombina" >
            <br>
            <label for="creatininahemato">Creatinina:</label>
            <input type="number" id="creatininahemato" name="creatininahemato" >
            <br>
            <label for="albumina">Albúmina:</label>
            <input type="number" id="albumina" name="albumina" >
            <br>
            <label for="plaquetas">Plaquetas:</label>
            <input type="number" id="plaquetas" name="plaquetas" >
            <br>
            <label for="cirugiaAbdominalPrevia">Cirugía abdominal previa:</label>
            <input type="checkbox" id="cirugiaAbdominalPrevia" name="cirugiaAbdominalPrevia">
            <br>
            <label for="peritonitisBacterianaEspontanea">Peritonitis bacteriana espontánea:</label>
            <input type="checkbox" id="peritonitisBacterianaEspontanea" name="peritonitisBacterianaEspontanea">
            <br>
            <div id="bleedingScoreMessage" style="padding: 5px; background-color: green; color: white;">
                Bajo riesgo de sangrado. Score: 0
            </div>
        </fieldset>
        <button type="button" onclick="showPreviousSection(5)">Anterior</button>
        <button type="button" onclick="showNextSection(5)">Siguiente</button>
    </div>

        <div id="section6" class="section">
            <h2>Valoración Endocrinometabólica</h2>
            <!-- Contenido de la sección -->
            <button type="button" onclick="showPreviousSection(6)">Anterior</button>
            <button type="button" onclick="showNextSection(6)">Siguiente</button>
        </div>
        <div id="section7" class="section">
            <h2>Estimación de riesgos y recomendaciones</h2>
            <!-- Contenido de la sección -->
            <button type="button" onclick="showPreviousSection(7)">Anterior</button>
        </div>
    </form>

    <script>
        function showNextSection(currentSection) {
            document.getElementById('section' + currentSection).classList.remove('active');
            document.getElementById('section' + (currentSection + 1)).classList.add('active');
        }

        function showPreviousSection(currentSection) {
            document.getElementById('section' + currentSection).classList.remove('active');
            document.getElementById('section' + (currentSection - 1)).classList.add('active');
        }

        function updateChildPughScore() {
            const ascitis = parseInt(document.getElementById('ascitis').value);
            const bilirrubina = parseInt(document.getElementById('bilirrubina').value);
            const inr = parseInt(document.getElementById('inr').value);
            const encefalopatia = parseInt(document.getElementById('encefalopatia').value);

            const totalScore = ascitis + bilirrubina + inr + encefalopatia;
            document.getElementById('childPughScore').innerText = totalScore;

            const escalaChild = document.getElementById('escalaChild');
            if (totalScore >= 5 && totalScore <= 6) {
                escalaChild.value = "1";
            } else if (totalScore >= 7 && totalScore <= 9) {
                escalaChild.value = "2";
            } else if (totalScore >= 10 && totalScore <= 15) {
                escalaChild.value = "3";
            }
            highlightChildRow();
        }

        function highlightChildRow() {
            const escalaChild = document.getElementById('escalaChild').value;
            document.getElementById('childA').classList.remove('highlight');
            document.getElementById('childB').classList.remove('highlight');
            document.getElementById('childC').classList.remove('highlight');

            if (escalaChild === "1") {
                document.getElementById('childA').classList.add('highlight');
            } else if (escalaChild === "2") {
                document.getElementById('childB').classList.add('highlight');
            } else if (escalaChild === "3") {
                document.getElementById('childC').classList.add('highlight');
            }
        }

        function updateMeldScores() {
            let creatinina = parseFloat(document.getElementById('creatinina').value) || 0;
            if (creatinina > 4) {
                creatinina = 4;
            }
            const bilirrubina = parseFloat(document.getElementById('bilirrubinaMeld').value) || 0;
            const inr = parseFloat(document.getElementById('inrMeld').value) || 0;
            const sodio = parseFloat(document.getElementById('sodio').value) || 0;

            const meldScore = 9.6 * Math.log(creatinina) + 3.8 * Math.log(bilirrubina) + 11.2 * Math.log(inr) + 6.4;
            const meldNaScore = meldScore - sodio - (0.025 * meldScore * (140 - sodio)) + 140;

            document.getElementById('meldScore').innerText = meldScore.toFixed(2);
            document.getElementById('meldNaScore').innerText = meldNaScore.toFixed(2);

            highlightMeldRow(meldScore);
        }

        function highlightMeldRow(meldScore) {
            document.getElementById('meld40').classList.remove('highlight');
            document.getElementById('meld30_39').classList.remove('highlight');
            document.getElementById('meld20_29').classList.remove('highlight');
            document.getElementById('meld10_19').classList.remove('highlight');
            document.getElementById('meldMenor9').classList.remove('highlight');

            if (meldScore >= 40) {
                document.getElementById('meld40').classList.add('highlight');
            } else if (meldScore >= 30) {
                document.getElementById('meld30_39').classList.add('highlight');
            } else if (meldScore >= 20) {
                document.getElementById('meld20_29').classList.add('highlight');
            } else if (meldScore >= 10) {
                document.getElementById('meld10_19').classList.add('highlight');
            } else {
                document.getElementById('meldMenor9').classList.add('highlight');
            }
        }

        function calculateHfaPeefIndex() {
            const funcional  = parseInt(document.getElementById('funcional').value);
            const morfologico = parseInt(document.getElementById('morfologico').value);
            const biomarcador = parseInt(document.getElementById('biomarcador').value);
            const biomarcadorFA = parseInt(document.getElementById('biomarcadorFA').value);
            const indiceHfaPeef = funcional + morfologico + biomarcador + biomarcadorFA;
            document.getElementById('indiceHfaPeef').innerText = indiceHfaPeef;

            const resultado = document.getElementById('resultadoHfaPeef');
            if (indiceHfaPeef >= 5) {
                resultado.innerText = "Paciente con Insuficiencia cardiaca";
                resultado.style.backgroundColor = "red";
                resultado.style.color = "white";
            } else if (indiceHfaPeef > 2 && indiceHfaPeef < 5) {
                resultado.innerText = "Paciente con riesgo de insuficiencia cardiaca";
                resultado.style.backgroundColor = "yellow";
                resultado.style.color = "black";
            } else {
                resultado.innerText = "Paciente con bajo riesgo de insuficiencia cardiaca";
                resultado.style.backgroundColor = "green";
                resultado.style.color = "white";
            }
        }

        function resetBiomarcadorFA() {
            document.getElementById('biomarcadorFA').value = "0";
        }

        function resetBiomarcador() {
            document.getElementById('biomarcador').value = "0";
        }

        document.getElementById('funcional').addEventListener('change', calculateHfaPeefIndex);
        document.getElementById('morfologico').addEventListener('change', calculateHfaPeefIndex);
        document.getElementById('biomarcador').addEventListener('change', calculateHfaPeefIndex);
        document.getElementById('biomarcadorFA').addEventListener('change', calculateHfaPeefIndex);

        function evaluateStressEcho() {
            const diabetes = document.getElementById('diabetes').checked;
            const hipertension = document.getElementById('hipertension').checked;
            const dislipidemia = document.getElementById('dislipidemia').checked;
            const tabaquismo = document.getElementById('tabaquismo').checked;
            const historiaPatologiaCoronaria = document.getElementById('historiaPatologiaCoronaria').checked;
            const historiaFamiliarPatologiaCoronaria = document.getElementById('historiaFamiliarPatologiaCoronaria').checked;
            const arteriopatiaPeriferica = document.getElementById('arteriopatiaPeriferica').checked;
            const edad = parseInt(document.getElementById('edad').value) || 0;

            let riesgoModerado = 0;
            let mensaje = "No es necesario ecocardiograma de stress";
            let color = "green";

            if (diabetes || historiaPatologiaCoronaria) {
                mensaje = "Es necesario ecocardiograma de stress";
                color = "red";
            } else {
                if (hipertension) riesgoModerado++;
                if (dislipidemia) riesgoModerado++;
                if (tabaquismo) riesgoModerado++;
                if (historiaFamiliarPatologiaCoronaria) riesgoModerado++;
                if (arteriopatiaPeriferica) riesgoModerado++;

                if (riesgoModerado >= 2 || (riesgoModerado >= 1 && edad >= 50)) {
                    mensaje = "Es necesario ecocardiograma de stress";
                    color = "red";
                }
            }

            const stressEchoMessage = document.getElementById('stressEchoMessage');
            stressEchoMessage.innerText = mensaje;
            stressEchoMessage.style.backgroundColor = color;
        }

        function evaluateAngioTac() {
            const resultadoStress = parseInt(document.getElementById('resultadoStress').value);
            const angioTacMessage = document.getElementById('angioTacMessage');

            if (resultadoStress === 1 || resultadoStress === 2) {
                angioTacMessage.innerText = "Está indicado la realización de angioTAC";
                angioTacMessage.style.backgroundColor = "red";
            } else {
                angioTacMessage.innerText = "No es necesario angioTAC";
                angioTacMessage.style.backgroundColor = "green";
            }
        }

        function evaluateCoronariografia() {
            const estenosisDerecha = document.getElementById('estenosisDerecha').checked;
            const estenosisIzquierda = document.getElementById('estenosisIzquierda').checked;
            const scoreCalcico = document.getElementById('scoreCalcico').checked;
            const resultadoStress = parseInt(document.getElementById('resultadoStress').value);
            const historiaPatologiaCoronaria = document.getElementById('historiaPatologiaCoronaria').checked;

            const coronariografiaMessage = document.getElementById('coronariografiaMessage');

            if (estenosisDerecha || estenosisIzquierda || scoreCalcico || resultadoStress === 3 || historiaPatologiaCoronaria) {
                coronariografiaMessage.innerText = "Está indicado la realización de coronariografía";
                coronariografiaMessage.style.backgroundColor = "red";
            } else {
                coronariografiaMessage.innerText = "No es necesario realizar coronariografía";
                coronariografiaMessage.style.backgroundColor = "green";
            }
        }

        function evaluateCateterismoDerecho() {
            const fraccionVD = parseInt(document.getElementById('fraccionVD').value);
            const tapse = parseFloat(document.getElementById('Tapse').value) || 16;
            const papsEstimada = parseFloat(document.getElementById('papsEstimada').value) || 44;

            const cateterismoMessage = document.getElementById('cateterismoMessage');

            if (fraccionVD === 1 && tapse > 14 && papsEstimada < 45) {
                cateterismoMessage.innerText = "No está indicado la realización de cateterismo derecho";
                cateterismoMessage.style.backgroundColor = "green";
            } else {
                cateterismoMessage.innerText = "Está indicada la realización de cateterismo derecho";
                cateterismoMessage.style.backgroundColor = "red";
            };
        }


        function evaluateAaGradient() {
            const fio2 = parseFloat(document.getElementById('fio2').value) || 0.21;
            const paco2 = parseFloat(document.getElementById('paco2').value) || 35;
            const pao2 = parseFloat(document.getElementById('pao2').value) || 95;
            const edad = parseInt(document.getElementById('edad').value) || 50;

            const aaGradient = (713 * fio2) - (paco2 / 0.8) - pao2;
            const aaGradientMessage = document.getElementById('aaGradientMessage');
            const ecoContrasteMessage = document.getElementById('ecoContrasteMessage');

            aaGradientMessage.innerText = "Gradiente A-a de oxígeno: " + aaGradient.toFixed(2);

            if ((edad > 64 && aaGradient > 20) || (edad <= 64 && aaGradient > 15)) {
                aaGradientMessage.style.backgroundColor = "red";
                ecoContrasteMessage.innerText = "Se requiere realizar eco contraste para valorar shunt";
                ecoContrasteMessage.style.backgroundColor = "red";
            } else {
                aaGradientMessage.style.backgroundColor = "green";
                ecoContrasteMessage.innerText = "No se requiere ecografía de contraste";
                ecoContrasteMessage.style.backgroundColor = "green";
            }

            highlightPaO2Row(pao2);
        }

        function evaluateEdad(){
            evaluateAaGradient();
            evaluateStressEcho();
        }
        function evaluateStress(){
            evaluateAngioTac();
            evaluateCoronariografia();
        }
        function highlightPaO2Row(pao2) {
            document.getElementById('leve').style.backgroundColor = "";
            document.getElementById('moderada').style.backgroundColor = "";
            document.getElementById('severa').style.backgroundColor = "";
            document.getElementById('muySevera').style.backgroundColor = "";

            if (pao2 >= 80) {
                document.getElementById('leve').style.backgroundColor = "red";
            } else if (pao2 >= 60) {
                document.getElementById('moderada').style.backgroundColor = "red";
            } else if (pao2 >= 50) {
                document.getElementById('severa').style.backgroundColor = "red";
            } else {
                document.getElementById('muySevera').style.backgroundColor = "red";
            }
        }

        function evaluatePulmonaryFunction() {
            const fev1 = parseFloat(document.getElementById('fev1').value) || 0;
            const fvc = parseFloat(document.getElementById('fvc').value) || 0;
            const fev1FvcRatio = fev1 / fvc;
            const pulmonaryFunctionMessage = document.getElementById('pulmonaryFunctionMessage');

            document.getElementById('fev1FvcRatio').innerText = fev1FvcRatio.toFixed(2);

            if (fev1FvcRatio < 0.7) {
                if (fvc <= 80) {
                    if (fvc > 65) {
                        pulmonaryFunctionMessage.innerText = "Patrón restrictivo leve (FVC > 65%)";
                    } else if (fvc >= 50) {
                        pulmonaryFunctionMessage.innerText = "Patrón restrictivo moderado (FVC 50-65%)";
                    } else if (fvc >= 35) {
                        pulmonaryFunctionMessage.innerText = "Patrón restrictivo severo (FVC 35-49%)";
                    } else {
                        pulmonaryFunctionMessage.innerText = "Patrón restrictivo muy severo (FVC >35%)";
                    }
                    pulmonaryFunctionMessage.style.backgroundColor = "red";
                } else {
                    pulmonaryFunctionMessage.innerText = "Patrón normal";
                    pulmonaryFunctionMessage.style.backgroundColor = "green";
                }
            } else {
                if (fvc <= 80) {
                    pulmonaryFunctionMessage.innerText = "Patrón mixto";
                    pulmonaryFunctionMessage.style.backgroundColor = "red";
                } else {
                    if (fev1 > 65) {
                        pulmonaryFunctionMessage.innerText = "Patrón obstructivo leve (FEV1 > 65%)";
                    } else if (fev1 >= 50) {
                        pulmonaryFunctionMessage.innerText = "Patrón obstructivo moderado (FEV1 50-65%)";
                    } else if (fev1 >= 35) {
                        pulmonaryFunctionMessage.innerText = "Patrón obstructivo severo (FEV1 35-49%)";
                    } else {
                        pulmonaryFunctionMessage.innerText = "Patrón obstructivo muy severo (FEV1 <35%)";
                    }
                    pulmonaryFunctionMessage.style.backgroundColor = "red";
                }
            }
        };

        function calculateEGFR() {
            const creatinine = parseFloat(document.getElementById('currentCreatinine').value || 0.5);
            const sexo = parseInt(document.getElementById('sexo').value);
            const edad = parseInt(document.getElementById('edad').value) || 45;
            const k = sexo === 1 ? 0.9 : 0.7;
            const a = sexo === 1 ? -0.411 : -0.329;
            const min = Math.min(creatinine / k, 1);
            const max = Math.max(creatinine / k, 1);
            const eGFR = 141 * Math.pow(min, a) * Math.pow(max, -1.209) * Math.pow(0.993, edad) * (sexo === 2 ? 1.018 : 1);

             document.getElementById('egfrValue').innerText = eGFR.toFixed(2);

            // Reset table row backgrounds
            const rows = document.querySelectorAll('#egfrTable tr');
            rows.forEach(row => row.style.backgroundColor = '');

            // Highlight the appropriate row
            if (eGFR >= 90) {
                document.getElementById('grado1').style.backgroundColor = 'red';
            } else if (eGFR >= 60) {
                document.getElementById('grado2').style.backgroundColor = 'red';
            } else if (eGFR >= 45) {
                document.getElementById('grado3a').style.backgroundColor = 'red';
            } else if (eGFR >= 30) {
                document.getElementById('grado3b').style.backgroundColor = 'red';
            } else if (eGFR >= 15) {
                document.getElementById('grado4').style.backgroundColor = 'red';
            } else {
                document.getElementById('grado5').style.backgroundColor = 'red';
            }   
            checkAKI();
        }

        function checkAKI() {
            const currentCreatinine = parseFloat(document.getElementById('currentCreatinine').value|| 0.5);
            const previousCreatinine = parseFloat(document.getElementById('previousCreatinine').value || 0.5);
            const akiMessage = document.getElementById('akiMessage');

            if (currentCreatinine >= previousCreatinine * 1.5 && currentCreatinine <= previousCreatinine * 2 ) {
                akiMessage.style.backgroundColor = 'red';
                akiMessage.innerText = "Posible AKI grado 1 (aumento en 0,3 mg/dl o incremento 1,5-2 veces valor previo)";
            } else if (currentCreatinine > previousCreatinine * 2 && currentCreatinine <= previousCreatinine * 3) {
                akiMessage.style.backgroundColor = 'red';
                akiMessage.innerText = "Posible AKI grado 2 (incremento 2-3 veces valor previo)";
            } else if (currentCreatinine > previousCreatinine * 3 || currentCreatinine >= 4) {
                akiMessage.style.backgroundColor = 'red';
                akiMessage.innerText = "Posible AKI grado 3 (incremento >3 veces valor previo o Cr >=4gr/dl)";
            } else {
                akiMessage.style.backgroundColor = 'green';
                akiMessage.innerText = "AKI poco probable";
            }
}

        function calculateCRRTScore() {
            const falloHepatico = parseInt(document.getElementById('falloHepatico').value);
            const donanteAsistolia = parseInt(document.getElementById('donanteAsistolia').value);
            const retrasplante = parseInt(document.getElementById('retrasplante').value);
            const vasopresoresPreop = parseInt(document.getElementById('vasopresoresPreop').value);
            const crrtPreop = parseInt(document.getElementById('crrtPreop').value);
            const kPreop = parseFloat(document.getElementById('kPreop').value) || 3.5;
            //const isquemiaFrio = parseFloat(document.getElementById('isquemiaFrio').value) || 0.71;
            const bilirrubina = parseFloat(document.getElementById('bilirrubina').value) || 5;

            let score = 0;

            if (falloHepatico === 1) { // Crónico
                if (donanteAsistolia === 1) score += 10;
                if (retrasplante === 1) score += 9;
                if (vasopresoresPreop === 1) score += 7;
                if (crrtPreop === 1) score += 6;
                score += Math.floor((kPreop - 3.5) / 0.12);
                //score += Math.floor(isquemiaFrio / 0.72);
                score += Math.floor(bilirrubina / 6);
            } else if (falloHepatico === 2) { // Agudo
                if (donanteAsistolia === 1) score += 10;
                if (vasopresoresPreop === 1) score += 7;
                if (crrtPreop === 1) score += 28;
                //score += Math.floor(isquemiaFrio / 0.72);
                score += Math.floor(bilirrubina / 6);
            }
            let tiempo = 0;
            let mensaje = "";
            if (score >= 42 && falloHepatico===1){
                mensaje = " .Riesgo elevado de requerir CRRT intraoperatoria";

            }else if (score >=28 && falloHepatico ===2){
                mensaje = " .Riesgo elevado de requerir CRRT intraoperatoria";
            }else if (score <42  && falloHepatico ===1){
                tiempo = (42 - score) * 0.72;
                mensaje = " .Riesgo de necesitar CRRT si Tº isquemia frío > " + tiempo + " horas";
            } else if (score <28 && falloHepatico ===2){
                tiempo = (28 - score) * 0.72;
                mensaje = " .Riesgo de necesitar CRRT si Tº isquemia frío > " + tiempo + " horas";
            };
            const crrtScoreMessage = document.getElementById('crrtScoreMessage');
            crrtScoreMessage.innerText = "Score de CRRT: " + score + mensaje;
        }
        function calculateBleedingScore() {
            let score = 0;

            const retrasplante = document.getElementById('retrasplantehemato').value;
            const sexo = document.getElementById('sexohemato').value;
            const edad = parseFloat(document.getElementById('edadhemato').value);
            const hemoglobina = parseFloat(document.getElementById('hemoglobina').value);
            const protrombina = parseFloat(document.getElementById('protrombina').value);
            const creatinina = parseFloat(document.getElementById('creatininahemato').value);
            const albumina = parseFloat(document.getElementById('albumina').value);
            const plaquetas = parseFloat(document.getElementById('plaquetas').value);
            const messageDiv = document.getElementById('bleedingScoreMessage');
            const cirugiaAbdominalPrevia = document.getElementById('cirugiaAbdominalPrevia').checked;
            const peritonitisBacterianaEspontanea = document.getElementById('peritonitisBacterianaEspontanea').checked;

            if (retrasplante == '1') score += 1;
            if (hemoglobina < 10) score += 1;
            if (edad > 40) score += 1;
            if (protrombina >2) score += 2;
            if (sexo == '1' && creatinina >= 1.36) score += 1;
            if (sexo == '2' && creatinina >= 1.28) score += 1;
            if (plaquetas < 70000) score += 1;
            if (albumina < 24) score += 1;

            
            if (score >= 3 || cirugiaAbdominalPrevia || peritonitisBacterianaEspontanea) {
                messageDiv.style.backgroundColor = 'red';
                messageDiv.innerHTML = `Alto riesgo de sangrado. Score: ${score}`;
            } else {
                messageDiv.style.backgroundColor = 'green';
                messageDiv.innerHTML = `Bajo riesgo de sangrado. Score: ${score}`;
            }
        }
//listeners
        document.getElementById('resultadoStress').addEventListener('change', evaluateStress);
        document.getElementById('estenosisDerecha').addEventListener('change', evaluateCoronariografia);
        document.getElementById('estenosisIzquierda').addEventListener('change', evaluateCoronariografia);
        document.getElementById('scoreCalcico').addEventListener('change', evaluateCoronariografia);
        document.getElementById('historiaPatologiaCoronaria').addEventListener('change', evaluateCoronariografia);
        document.getElementById('fraccionVD').addEventListener('change', evaluateCateterismoDerecho);
        document.getElementById('Tapse').addEventListener('input', evaluateCateterismoDerecho);
        document.getElementById('papsEstimada').addEventListener('input', evaluateCateterismoDerecho);
        document.getElementById('fio2').addEventListener('input', evaluateAaGradient);
        document.getElementById('paco2').addEventListener('input', evaluateAaGradient);
        document.getElementById('pao2').addEventListener('input', evaluateAaGradient);
        document.getElementById('edad').addEventListener('input', evaluateEdad);
        document.getElementById('fvc').addEventListener('input', evaluatePulmonaryFunction);
        document.getElementById('falloHepatico').addEventListener('change', calculateCRRTScore);
        document.getElementById('donanteAsistolia').addEventListener('change', calculateCRRTScore);
        document.getElementById('retrasplante').addEventListener('change', calculateCRRTScore);
        document.getElementById('vasopresoresPreop').addEventListener('change', calculateCRRTScore);
        document.getElementById('crrtPreop').addEventListener('change', calculateCRRTScore);
        document.getElementById('kPreop').addEventListener('input', calculateCRRTScore);
        document.getElementById('bilirrubina').addEventListener('input', calculateCRRTScore);
        
        document.getElementById('retrasplantehemato').addEventListener('change', calculateBleedingScore);
        document.getElementById('sexohemato').addEventListener('change', calculateBleedingScore);
        document.getElementById('edadhemato').addEventListener('input', calculateBleedingScore);
        document.getElementById('hemoglobina').addEventListener('input', calculateBleedingScore);
        document.getElementById('protrombina').addEventListener('input', calculateBleedingScore);
        document.getElementById('creatininahemato').addEventListener('input', calculateBleedingScore);
        document.getElementById('albumina').addEventListener('input', calculateBleedingScore);
        document.getElementById('plaquetas').addEventListener('input', calculateBleedingScore);
        
    </script>
</body>
</html>